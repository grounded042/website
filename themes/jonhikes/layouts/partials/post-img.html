{{/*
- https://harrycresswell.com/writing/responsive-images-next-gen-formats/
- https://blog.webdevsimplified.com/2023-05/responsive-images/
- https://www.adamwills.io/blog/responsive-images-hugo/
- https://stackoverflow.com/questions/7261855/recommendation-for-compressing-jpg-files-with-imagemagick
- https://developer.android.com/training/multiscreen/screendensities
- https://developer.mozilla.org/en-US/docs/Web/HTML/Element/source
- https://requestmetrics.com/web-performance/high-performance-images/
- https://www.debugbear.com/blog/responsive-images
- https://makewithhugo.com/add-avif-feature-image/
- https://www.brycewray.com/posts/2023/04/better-code-image-processing-hugo/
- https://mertbakir.gitlab.io/hugo/image-processing-in-hugo/
- https://hugocodex.org/blog/image-compression-for-the-lazy/

TODO: fail if file not found
{{ if fileExists (replace .Params.featured_image "jpg" "avif") }}

TODO: lazy loading

TODO: LQIP?
- https://endler.dev/2017/image-previews/

*/}}
{{ $filename := (strings.TrimSuffix ".HEIC" .src) }}
{{- if not (eq (.context.Resources.Get .src) nil) -}}
<div class="r-img">
	<picture>
		<source type="image/avif" srcset="
			{{ (.context.Resources.Get (printf "%s.avif" $filename)).RelPermalink }} 1x,
			{{ (.context.Resources.Get (printf "%s@2x.avif" $filename)).RelPermalink }} 2x,
			{{ (.context.Resources.Get (printf "%s@3x.avif" $filename)).RelPermalink }} 3x,
			{{ (.context.Resources.Get (printf "%s@4x.avif" $filename)).RelPermalink }} 4x
		">
		<source type="image/webp" srcset="
			{{ (.context.Resources.Get (printf "%s.webp" $filename)).RelPermalink }} 1x,
			{{ (.context.Resources.Get (printf "%s@2x.webp" $filename)).RelPermalink }} 2x,
			{{ (.context.Resources.Get (printf "%s@3x.webp" $filename)).RelPermalink }} 3x,
			{{ (.context.Resources.Get (printf "%s@4x.webp" $filename)).RelPermalink }} 4x
		">
		<img
			src="{{ (.context.Resources.Get (printf "%s.jpeg" $filename)).RelPermalink }}"
			srcset="
				{{ (.context.Resources.Get (printf "%s.jpeg" $filename)).RelPermalink }} 1x,
				{{ (.context.Resources.Get (printf "%s@2x.jpeg" $filename)).RelPermalink }} 2x,
				{{ (.context.Resources.Get (printf "%s@3x.jpeg" $filename)).RelPermalink }} 3x,
				{{ (.context.Resources.Get (printf "%s@4x.jpeg" $filename)).RelPermalink }} 4x
			"
			sizes="(max-width: 800px) 100vw, 800px"
			alt="{{ .caption }}"
		/>
	</picture>
</div>
{{- end -}}
